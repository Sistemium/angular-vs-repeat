//
// Copyright Kamil PÄ™kala http://github.com/kamilkp
// Angular Virtual Scroll Repeat v1.1.7 2016/03/08
//
!function(a,b){"use strict";function c(c){function d(d,i){function j(d,i,j){function k(a){var c=j.vsSize||j.vsSizeProperty;if(!c)return d.elementSize;var e=d.$new(!1);b.extend(e,a),e[n]=a;var f=e.$eval(c);return e.$destroy(),f}function l(){if(!J||J.length<1)E=0,d[v]=[],d.sizesCumulative=[0];else if(E=J.length,M){d.sizes=J.map(d.vsSizeFn||k);var a=0;d.sizesCumulative=d.sizes.map(function(b){var c=a;return a+=b,c}),d.sizesCumulative.push(a)}else m();A()}function m(){L&&d.$$postDigest(function(){if(F[0].offsetHeight||F[0].offsetWidth){for(var a=F.children(),b=0,c=!1,e=!1;b<a.length;){if(null!=a[b].attributes[q]||e){if(c||(d.elementSize=0),c=!0,a[b][Q]&&(d.elementSize+=a[b][Q]),!w)break;if(null!=a[b].attributes["ng-repeat-end"]||null!=a[b].attributes["data-ng-repeat-end"])break;e=!0}b++}c&&(A(),L=!1,d.$root&&!d.$root.$$phase&&d.$apply())}else var f=d.$watch(function(){(F[0].offsetHeight||F[0].offsetWidth)&&(f(),m())})})}function r(){var a="tr"===H?"":"min-",b=K?a+"width":a+"height";return b}function s(){O.latch&&setTimeout(function(){var a=E;V=Math.max(a,V),d.endIndex=O.latch?V:a,d[v]=J.slice(d.startIndex,d.endIndex),T=d.endIndex,d.beforeSize=0,d.afterSize=0,d.$apply(function(){d.$emit("vsRenderAllDone")})})}function t(){D()&&d.$applyAsync()}function y(){"undefined"!=typeof j.vsAutoresize&&(L=!0,m(),d.$root&&!d.$root.$$phase&&d.$apply()),D()&&d.$apply()}function z(a){return M?d.sizesCumulative[a]:d.elementSize*a}function A(){S=void 0,T=void 0,U=E,V=0,B(z(E)),D(),d.$emit("vsRepeatReinitialized",d.startIndex,d.endIndex)}function B(a){d.totalSize=d.offsetBefore+a+d.offsetAfter}function C(){var a=e(N[0],P);a!==W&&(A(),d.$root&&!d.$root.$$phase&&d.$apply()),W=a}function D(){function a(){for(m-=d.sizesCumulative[d.sizesCumulative.length-1],m>0&&(c-=m),k=0;d.sizesCumulative[k]<c-d.offsetBefore-i;)k++;for(k>0&&k--,k=Math.max(Math.floor(k-d.excess),0),l=k;d.sizesCumulative[l]<c-d.offsetBefore-i+h;)l++;l=Math.min(Math.ceil(l+d.excess),E)}function b(a,b){var c=b+a.startIndex;return a.offsetBefore+(M?a.sizesCumulative[c]:c*a.elementSize)}var c=f(N[0],R),h=e(N[0],P),i=F[0]===N[0]?0:g(F[0],N[0],K),k=d.startIndex,l=d.endIndex;c<0&&(c=0);var m=c+h;M?a():(m-=d.elementSize*E,m>0&&(c-=m),k=Math.max(Math.floor((c-d.offsetBefore-i)/d.elementSize-d.excess),0),l=Math.min(k+Math.ceil(h/d.elementSize)+2*d.excess,E)),U=Math.min(k,U),V=Math.max(l,V),d.startIndex=O.latch?U:k,d.endIndex=O.latch?V:l,V<d.startIndex&&(d.startIndex=V);var n=!1;if(null==S?n=!0:null==T&&(n=!0),n||(O.hunked?Math.abs(d.startIndex-S)>=d.excess||0===d.startIndex&&0!==S?n=!0:(Math.abs(d.endIndex-T)>=d.excess||d.endIndex===E&&T!==E)&&(n=!0):n=d.startIndex!==S||d.endIndex!==T),n){d[v]=J.slice(d.startIndex,d.endIndex),d.$emit("vsRepeatInnerCollectionUpdated",d.startIndex,d.endIndex,S,T);var o;j.vsScrolledToEnd&&(o=J.length-(d.scrolledToEndOffset||0),(d.endIndex>=o&&T<o||J.length&&d.endIndex===J.length)&&d.$eval(j.vsScrolledToEnd)),j.vsScrolledToBeginning&&(o=d.scrolledToBeginningOffset||0,d.startIndex<=o&&S>d.startIndex&&d.$eval(j.vsScrolledToBeginning)),S=d.startIndex,T=d.endIndex,d.beforeSize=b(d,0),d.afterSize=d.totalSize-b(d,d[v].length)}return n}j.vsSizeFn&&(d.vsSizeFn=d.$eval(j.vsSizeFn));var E,F=b.isDefined(j.vsRepeatContainer)?b.element(i[0].querySelector(j.vsRepeatContainer)):i,G=b.element(u),H=G[0].tagName.toLowerCase(),I=j.beforeTagName||H,J=[],K="undefined"!=typeof j.vsHorizontal,L=!j.vsRepeat,M=d.vsSizeFn||!!j.vsSize||!!j.vsSizeProperty,N=j.vsScrollParent?"window"===j.vsScrollParent?b.element(a):h().call(F,j.vsScrollParent):F,O="vsOptions"in j?d.$eval(j.vsOptions):{},P=K?"clientWidth":"clientHeight",Q=K?"offsetWidth":"offsetHeight",R=K?"scrollLeft":"scrollTop";if(d.totalSize=0,!("vsSize"in j)&&"vsSizeProperty"in j&&console.warn("vs-size-property attribute is deprecated. Please use vs-size attribute which also accepts angular expressions."),0===N.length)throw"Specified scroll parent selector did not match any element";d.$scrollParent=N,M&&(d.sizesCumulative=[]),d.elementSize=+j.vsRepeat||e(N[0],P)||50,d.offsetBefore=0,d.offsetAfter=0,d.excess=2,Object.keys(x).forEach(function(a){j[a]&&j.$observe(a,function(b){d[x[a]]=+b,A()})}),d.$watchCollection(o,function(a){J=a||[],l()});var S,T,U,V,W,X=" ng-style=\"{'"+r()+"': beforeSize + 'px' }\"",Y=" ng-style=\"{'"+r()+"': afterSize  + 'px' }\"",Z=["<",I,X,' class="vs-repeat-before-content"></',I,">"],$=["<",I,Y,' class="vs-repeat-after-content"></',I,">"],_=b.element(Z.join("")),aa=b.element($.join(""));G.eq(0).attr(q,n+" in "+v+(p?" "+p:"")),G.addClass("vs-repeat-repeated-element"),F.append(c(_)(d)),F.append(G),c(G)(d),F.append(c(aa)(d)),d.startIndex=0,d.endIndex=0,K?(_.css("height","100%"),aa.css("height","100%")):(_.css("width","100%"),aa.css("width","100%")),N.on("scroll",t),b.element(a).on("resize",y),d.$on("$destroy",function(){b.element(a).off("resize",y),N.off("scroll",t)}),d.$on("vsRepeatTrigger",l),d.$on("vsRepeatResize",function(){L=!0,m()}),d.$on("vsRenderAll",s),d.$watch(function(){"function"==typeof a.requestAnimationFrame?a.requestAnimationFrame(C):C()})}function k(a){return!s.attr(a)||(q=a,t=s.attr(a),void(w=a.match(/start$/)))}function l(){for(var a=0,b=r.children().eq(0);null==b.attr("ng-repeat-end")&&null==b.attr("data-ng-repeat-end");)a++,b=r.children().eq(a),u+=b[0].outerHTML}var m,n,o,p,q,r=b.isDefined(i.vsRepeatContainer)?b.element(d[0].querySelector(i.vsRepeatContainer)):d,s=r.children().eq(0),t="",u=s[0].outerHTML,v="$vs_collection",w=!1,x={vsRepeat:"elementSize",vsOffsetBefore:"offsetBefore",vsOffsetAfter:"offsetAfter",vsScrolledToEndOffset:"scrolledToEndOffset",vsScrolledToBeginningOffset:"scrolledToBeginningOffset",vsExcess:"excess"};if(k("ng-repeat")&&k("data-ng-repeat")&&k("ng-repeat-start")&&k("data-ng-repeat-start"))throw new Error("angular-vs-repeat: no ng-repeat directive on a child element");return m=/^\s*(\S+)\s+in\s+([\S\s]+?)(track\s+by\s+\S+)?$/.exec(t),n=m[1],o=m[2],p=m[3],w&&l(),r.empty(),{pre:j}}return{restrict:"A",scope:!0,compile:d}}function d(){if("pageYOffset"in a)return{scrollTop:pageYOffset,scrollLeft:pageXOffset};var b,c,d=document,e=d.documentElement,f=d.body;return b=e.scrollLeft||f.scrollLeft||0,c=e.scrollTop||f.scrollTop||0,{scrollTop:c,scrollLeft:b}}function e(b,c){return b===a?"clientWidth"===c?a.innerWidth:a.innerHeight:b[c]}function f(b,c){return b===a?d()[c]:b[c]}function g(b,c,e){var f=e?"left":"top",g=b.getBoundingClientRect()[f],h=c===a?0:c.getBoundingClientRect()[f],i=c===a?d():c;return g-h+i[e?"scrollLeft":"scrollTop"]}function h(){var a=document.documentElement,c=a.matches?"matches":a.matchesSelector?"matchesSelector":a.webkitMatches?"webkitMatches":a.webkitMatchesSelector?"webkitMatchesSelector":a.msMatches?"msMatches":a.msMatchesSelector?"msMatchesSelector":a.mozMatches?"mozMatches":a.mozMatchesSelector?"mozMatchesSelector":null;return b.element.prototype.closest||function(a){for(var d=this[0].parentNode;d!==document.documentElement&&null!=d&&!d[c](a);)d=d.parentNode;return d&&d[c](a)?b.element(d):b.element()}}var i=b.module("vs-repeat",[]).directive("vsRepeat",["$compile","$parse",c]);"undefined"!=typeof module&&module.exports&&(module.exports=i.name)}(window,window.angular);